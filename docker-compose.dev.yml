
services:
  # API Gateway service
  api-gateway:
    container_name: api-gateway
    build:
      context: .                          # Root of your project
      dockerfile: ./apps/api-gateway/Dockerfile    # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:api-gateway"] # Override default command
    env_file:
      - ./apps/api-gateway/.env           # Load env vars from this file
    volumes:
      - ./apps/api-gateway:/usr/src/app/apps/api-gateway                    # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/app/node_modules         # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    ports:
      - "3000:3000"                       # Expose your API Gateway
    networks:
      - microservices

  # Users service
  users-service:
    container_name: users-service
    build:
      context: .                          # Root of your project
      dockerfile: ./apps/users/Dockerfile    # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:users"] # Override default command
    env_file:
      - ./apps/users/.env                 # Load env vars from this file
    volumes:
      - ./apps/users:/usr/src/app/apps/users                    # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/app/node_modules         # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    ports:
      - "3003:3003"                       # Expose your Users service
    networks:
      - microservices

  # Resume service
  resume-service:
    container_name: resume-service
    build: 
      context: .                          # Root of your project
      dockerfile: ./apps/resume/Dockerfile # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:resume"] # Override default command
    env_file:
      - ./apps/resume/.env                # Load env vars from this file
    volumes:
      - ./apps/resume:/usr/src/app/apps/resume                   # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/node_modules             # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    ports:
      - "3002:3002"                       # Expose your Resume service
    networks:
      - microservices

  # Auth service
  auth-service:
    container_name: auth-service
    build: 
      context: .                          # Root of your project
      dockerfile: ./apps/auth/Dockerfile  # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:auth"] # Override default command
    env_file:
      - ./apps/auth/.env                  # Load env vars from this file
    volumes:
      - ./apps/auth:/usr/src/app/apps/auth                    # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/node_modules             # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    ports:
      - "3001:3001"                       # Expose your Auth service
    networks:
      - microservices

  # AI service
  ai-service:
    container_name: ai-service
    build:
      context: .                          # Root of your project
      dockerfile: ./apps/ai/Dockerfile    # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:ai"] # Override default command
    env_file:
      - ./apps/ai/.env                    # Load env vars from this file
    volumes:
      - ./apps/ai:/usr/src/app/apps/ai                    # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/app/node_modules         # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    ports:
      - "3004:3004"                       # Expose your AI service
    networks:
      - microservices

  # Cover Letter service
  cover-letter-service:
    container_name: cover-letter-service
    build:
      context: .                          # Root of your project
      dockerfile: ./apps/cover-letter/Dockerfile    # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:cover-letter"] # Override default command
    env_file:
      - ./apps/cover-letter/.env          # Load env vars from this file
    volumes:
      - ./apps/cover-letter:/usr/src/app/apps/cover-letter                    # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/app/node_modules         # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    ports:
      - "3005:3005"                       # Expose your Cover Letter service
    networks:
      - microservices

  # Notification service
  notification-service:
    container_name: notification-service
    build:
      context: .                          # Root of your project
      dockerfile: ./apps/notification/Dockerfile    # Path to your custom Dockerfile
      target: development                 # Use the "development" stage
    command: ["npm", "run", "start:dev:notification"] # Override default command
    env_file:
      - ./apps/notification/.env          # Load env vars from this file
    volumes:
      - ./apps/notification:/usr/src/app/apps/notification                    # Mounts the current local project directory (host) to the container's working directory.
      - ./libs:/usr/src/app/libs
      - /usr/src/app/node_modules         # Prevents overwriting of node_modules by mounting the container's node_modules directory.
    restart: always
    networks:
      - microservices

# Shared network for all microservices
networks:
  microservices:
    driver: bridge                         # Default bridge driver for container communication
